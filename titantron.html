<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1">
<style>
html,body{
  margin:0; width:100%; height:100%;
  background:#000; overflow:hidden;
}
#wrap{ position:absolute; inset:0; background:#000; overflow:hidden; }

/* idle graphic */
#idle{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  display:none;
}

/* container that we size in JS to "cover" */
#box{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  overflow:hidden;
  display:none;
  background:#000;
}

#player{
  position:absolute; inset:0;
  width:100%; height:100%;
  border:0;
}
</style>
</head>
<body>
<div id="wrap">
  <img id="idle" alt="idle">
  <div id="box">
    <iframe id="player" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>
  </div>
</div>

<script>
const qs = new URLSearchParams(location.search);
const vid = qs.get("v");
const origin = location.origin;

// repo root: https://mari-debug-sys.github.io/SHE-tron/idle.png
const idleSrc = origin + "/SHE-tron/idle.png";

const idleImg = document.getElementById("idle");
const box     = document.getElementById("box");
const frame   = document.getElementById("player");

// YouTube player "frame" behaves like 16:9 for our purposes
const TARGET_AR = 16 / 9;

function setCoverBox() {
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const ar = vw / vh;

  // COVER logic: choose size that fully covers viewport with minimal crop
  let w, h;
  if (ar > TARGET_AR) {
    // viewport is wider than 16:9 -> set width to viewport, height expands (crop top/bottom)
    w = vw;
    h = vw / TARGET_AR;
  } else {
    // viewport is taller/narrower than 16:9 -> set height to viewport, width expands (crop sides)
    h = vh;
    w = vh * TARGET_AR;
  }

  box.style.width  = w + "px";
  box.style.height = h + "px";
}

function showIdle(){
  frame.src = "";
  box.style.display = "none";
  idleImg.style.display = "block";
  idleImg.src = idleSrc;
}

function showVideo(id){
  idleImg.style.display = "none";
  box.style.display = "block";

  setCoverBox();
  window.addEventListener("resize", setCoverBox);

  frame.src =
    "https://www.youtube-nocookie.com/embed/" + id +
    "?autoplay=1" +
    "&mute=0" +                 // ARENA AUDIO
    "&controls=0" +
    "&rel=0" +
    "&playsinline=1" +
    "&iv_load_policy=3" +
    "&modestbranding=1" +
    "&loop=1&playlist=" + id +
    "&start=0" +
    "&vq=hd720" +
    "&origin=" + encodeURIComponent(origin);
}

if (!vid) showIdle();
else showVideo(vid);
</script>
</body>
</html>
